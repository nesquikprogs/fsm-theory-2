
# Lab Work: ATM as a Finite State Machine with State Pattern

## Цель работы
Реализовать банкомат как конечный автомат с использованием паттерна **State**.  
Каждое состояние банкомата (Idle, PIN, Выдача и др.) оформлено отдельным классом.  
Контекст (`ATMContext`) хранит текущее состояние и делегирует события, обеспечивая чистую логику без условий.

## Архитектура

- **State** — отдельный класс для каждого состояния:
  - Idle — ожидание карты  
  - PIN — ввод пин-кода  
  - Menu — выбор операции  
  - Operation — снятие/пополнение и др.  
  - Receipt — выдача чека  
  - CardReturn — возврат карты  
- **Context (ATMContext)**:
  - Хранит `currentState`  
  - Делегирует все события состояниям (всего 11 строк делегирования)  
  - Контекст не принимает решения — состояние решает, что делать дальше  

## Логика работы

- Вставка карты → ввод ПИН → меню → выполнение операции → чек → возврат карты → продолжить → старт нового сеанса  
- 3 неверных ввода ПИН → конфискация карты  
- Кнопка Отмена работает в любой момент и возвращает в Idle  
- UI обновляется напрямую из состояния  
- Асинхронные задержки реализованы через `Task.Delay`  
- История операций отображается слева в интерфейсе  

## Преимущества подхода

- Чёткая изоляция логики состояний  
- Легко расширять новые состояния или операции  
- Контекст остаётся «глупым», что упрощает поддержку и тестирование  
- Пользовательский интерфейс синхронизирован с состояниями  
